@using CommunityHub.Core.Dtos;

@model List<UserInfoDto>

@{
    ViewData["Title"] = "ANZ Havyaka Family Directory";
    // var allLocations = Model
    //     .Select(user => user.Location)
    //     .Concat(Model.Select(user => user.SpouseInfo?.Location).Where(location => location != null))
    //     .Distinct()
    //     .OrderBy(location => location)
    //     .ToList();
}

<style>

.table
{
    margin: 75px;
}
</style>
<!-- Link to the external CSS file -->
<link rel="stylesheet" href="~/css/styles.css" />

<h2 class="text-center">ANZ Havyaka Directory</h2>

<!-- Table for displaying user data -->
<table class="table table-striped table-bordered" id="users-table">
    <thead>
        <tr>
            <th rowspan="2">No.</th>
            <th colspan="4">Member Info</th>
            <th colspan="4">Spouse Info</th>
            <th rowspan="2">Kids</th>
        </tr>
        <tr>
            <th>Name</th>
            <th>Contact Info</th>
            <th>Location</th>
            <th>Native</th>
            <th>Name</th>
            <th>Contact Info</th>
            <th>Location</th>
            <th>Native</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model.Select((value, index) => new { value, index }))
        {
            <tr class="member-info">
                <!-- Sl. No. -->
                <td>@(user.index + 1)</td>

                <!-- Member Info -->
                <td>@user.value.FullName</td>
                <td>
                    @user.value.Email <br>
                    @string.Concat(user.value.CountryCode, "-", user.value.ContactNumber)
                </td>
                <td>@user.value.Location</td>
                <td>@user.value.HomeTown</td>

                <!-- Spouse Info -->
                @if (user.value.SpouseInfo == null)
                {
                    <td class="not-applicable"></td>
                    <td class="not-applicable"></td>
                    <td class="not-applicable"></td>
                }
                else
                {
                    <td class="spouse-info">@user.value.SpouseInfo.FullName</td>
                    <td class="spouse-info">
                        @user.value.SpouseInfo.Email <br>
                        @string.Concat(user.value.SpouseInfo.CountryCode, "-", user.value.SpouseInfo.ContactNumber)
                    </td>
                    <td class="spouse-info">@user.value.SpouseInfo.Location</td>
                    <td class="spouse-info">@user.value.SpouseInfo.HomeTown</td>
                }

                <!-- Kids Names -->
                <td class="@(user.value.Children == null || !user.value.Children.Any() ? "not-applicable" : "kids-info")">
                    @if (user.value.Children != null && user.value.Children.Any())
                    {
                        @foreach (var child in user.value.Children)
                        {
                            <div>@child.Name</div>
                        }
                    }
                    else
                    {
                        <span></span>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Pagination Controls -->
<div id="pagination-container" class="d-flex justify-content-center mt-3">
    <!-- First Button -->
    @if (ViewBag.CurrentPage > 1)
    {
        <a href="?page=1" class="btn btn-secondary">First</a>
    }
    else
    {
        <span class="btn btn-secondary disabled">First</span>
    }

    <!-- Previous Button -->
    @if (ViewBag.CurrentPage > 1)
    {
        <a href="?page=@(ViewBag.CurrentPage - 1)" class="btn btn-secondary">Previous</a>
    }
    else
    {
        <span class="btn btn-secondary disabled">Previous</span>
    }

    <!-- Page Number Buttons -->
    @for (var i = 1; i <= ViewBag.TotalPages; i++)
    {
        <a href="?page=@i" class="btn btn-secondary @((i == ViewBag.CurrentPage) ? "active" : "")">@i</a>
    }

    <!-- Next Button -->
    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
    {
        <a href="?page=@(ViewBag.CurrentPage + 1)" class="btn btn-secondary">Next</a>
    }
    else
    {
        <span class="btn btn-secondary disabled">Next</span>
    }

    <!-- Last Button -->
    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
    {
        <a href="?page=@(ViewBag.TotalPages)" class="btn btn-secondary">Last</a>
    }
    else
    {
        <span class="btn btn-secondary disabled">Last</span>
    }
</div>

